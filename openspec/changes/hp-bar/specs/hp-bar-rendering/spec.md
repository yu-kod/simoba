## ADDED Requirements

### Requirement: HP バーの基本描画
HP を持つエンティティの頭上に HP バーを描画しなければならない（SHALL）。HP バーはエンティティの中心上部（`-radius - offset` の Y 位置）に配置し、幅はエンティティの `radius * 2` を基準とする。高さは固定値（4-5px）とする。

#### Scenario: ヒーローの頭上に HP バーが表示される
- **WHEN** ヒーローの `hp` が `maxHp` より小さい
- **THEN** ヒーローの頭上に HP バーが描画され、エンティティの位置に追従する

#### Scenario: HP バーの幅がエンティティサイズに応じる
- **WHEN** radius が 22 のヒーローに HP バーが表示される
- **THEN** HP バーの幅は `22 * 2 = 44` を基準とした値になる

### Requirement: HP 残量の色分け表示
HP バーは背景（暗いグレー）の上に、現在 HP の割合に応じた長さの色付きバーを描画しなければならない（SHALL）。

#### Scenario: HP が 50% のとき
- **WHEN** `hp` が `maxHp` の 50%
- **THEN** 色付きバーが HP バー全幅の 50% の長さで左詰めに描画される

#### Scenario: HP が 0 のとき
- **WHEN** `hp` が 0
- **THEN** 色付きバーの長さが 0 になり、背景のみが表示される

### Requirement: チームカラーによる色分け
HP バーの色はエンティティのチーム（`team`）に基づいて決定しなければならない（SHALL）。プレイヤーと同じチームは緑系、敵チームは赤系とする。

#### Scenario: 味方ヒーローの HP バーは緑
- **WHEN** エンティティの `team` がプレイヤーと同じ
- **THEN** HP バーの色は緑系（`0x2ecc71`）で描画される

#### Scenario: 敵ヒーローの HP バーは赤
- **WHEN** エンティティの `team` がプレイヤーと異なる
- **THEN** HP バーの色は赤系（`0xe74c3c`）で描画される

### Requirement: HP バーの常時表示
HP バーはエンティティが存在する限り常に表示しなければならない（SHALL）。HP が満タンであっても非表示にしない。

#### Scenario: ダメージを受けていないヒーロー
- **WHEN** `hp === maxHp`
- **THEN** HP バーは表示され、満タンの緑/赤バーが描画される

#### Scenario: ダメージを受けたヒーロー
- **WHEN** `hp` が `maxHp` より減少する
- **THEN** HP バーは引き続き表示され、減少分が反映される

### Requirement: 250HP ごとの区切り線
HP バー上に 250HP ごとの黒い縦線（区切り線）を描画しなければならない（SHALL）。250 の倍数の位置のうち `maxHp` 未満のものすべてに描画する（バーの右端には描画しない）。`maxHp` が 250 以下の場合は区切り線なし。

#### Scenario: maxHp が 650 のヒーロー
- **WHEN** `maxHp` が 650
- **THEN** 区切り線は 2 本、250HP と 500HP の位置に描画される

#### Scenario: maxHp が 750 のヒーロー
- **WHEN** `maxHp` が 750
- **THEN** 区切り線は 2 本、250HP と 500HP の位置に描画される

#### Scenario: maxHp が 1000 のエンティティ
- **WHEN** `maxHp` が 1000
- **THEN** 区切り線は `floor(1000 / 250) - 1 = 3` 本、250HP・500HP・750HP の位置に描画される

#### Scenario: maxHp が 200 のエンティティ
- **WHEN** `maxHp` が 200
- **THEN** 区切り線は描画されない（`floor(200 / 250) - 1 < 1`）

### Requirement: トレイリングダメージバー
ダメージを受けたとき、減少前の HP 位置から現在 HP 位置までの区間を白いバーで表示し、一定の遅延後に縮小して消えなければならない（SHALL）。

#### Scenario: ダメージ直後に白バーが表示される
- **WHEN** HP が 650 から 500 に減少する
- **THEN** 現在 HP バー（500/650 の位置）の右端から、前回 HP（650/650 の位置）までの区間が白いバーで描画される

#### Scenario: 遅延後に白バーが縮小する
- **WHEN** トレイリングバーが表示されてから遅延時間（TRAIL_DELAY_MS）が経過する
- **THEN** 白バーが現在 HP の位置に向かって一定速度で縮小し始める

#### Scenario: 白バーが現在 HP に到達して消える
- **WHEN** 白バーの位置が現在 HP の位置に到達する
- **THEN** 白バーが消える（トレイリングバーが非アクティブになる）

#### Scenario: 連続ダメージで白バーが更新される
- **WHEN** トレイリングバーが縮小中に追加ダメージを受ける
- **THEN** 白バーの右端は変わらず（前回のトレイル位置を維持）、現在 HP バーが新しい HP 位置に更新される

### Requirement: エンティティ位置への追従
HP バーはエンティティの移動に毎フレーム追従しなければならない（SHALL）。

#### Scenario: ヒーローが移動する
- **WHEN** ヒーローが位置 (100, 200) から (150, 200) に移動する
- **THEN** HP バーもヒーローの新しい位置の上部に追従して描画される

### Requirement: 汎用性
HP バーは `CombatEntityState`（`hp`, `maxHp`, `position`, `team`）のみに依存し、エンティティの種類（ヒーロー・ミニオン・タワー等）に依存してはならない（SHALL NOT）。

#### Scenario: 異なるエンティティタイプに適用可能
- **WHEN** `CombatEntityState` を実装する任意のエンティティに HP バーを生成する
- **THEN** エンティティの種類に関係なく HP バーが正しく描画される
