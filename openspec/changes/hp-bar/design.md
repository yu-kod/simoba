## Context

近接攻撃システムでダメージが機能するようになったが、HP の変化が見えない。エンティティ頭上に HP バーを表示し、戦闘フィードバックを改善する。

現在の描画アーキテクチャ:
- `HeroRenderer` — Phaser Container 内に Graphics を持ち、`sync(state)` で位置・facing を更新
- `MeleeSwingRenderer` — `play()` / `update(delta)` パターンで時間ベースのエフェクトを管理
- `CombatEntityState` に `hp` / `maxHp` が既に定義済み

## Goals / Non-Goals

**Goals:**
- HP バーを汎用コンポーネントとして実装し、任意の `CombatEntityState` に適用可能にする
- エンティティ頭上に配置し、位置に追従する
- チームカラーで敵味方を区別する
- 250HP ごとの区切り線で HP 量を直感的に把握できるようにする
- トレイリングダメージバー（白バー）でダメージ量を視覚化する
- HP バーは常に表示する（満タン時も非表示にしない）

**Non-Goals:**
- ミニオン・タワー・ベースへの適用（エンティティ未実装）
- HP 数値テキスト表示
- 画面端 HUD（#34）

## Decisions

### 1. HpBarRenderer を独立クラスとして実装

`HeroRenderer` に HP バーロジックを直接埋め込まず、`HpBarRenderer` を独立した Phaser Graphics ベースのクラスとして作成する。

**理由:** 将来的にミニオン・タワー・ベースにも再利用するため、ヒーロー固有のコードと分離する必要がある。`HeroRenderer` の Container に子として追加する形で統合する。

**代替案:** `HeroRenderer` 内に直接描画 → ヒーロー以外への再利用が困難なため却下。

### 2. トレイリングダメージバーの状態管理

HP バーは `trailHp`（白バーが追跡中の HP 値）を内部状態として保持する。

- `sync()` 時に現在 `hp` が `trailHp` より低ければ、`trailHp` を更新開始
- 遅延時間（TRAIL_DELAY_MS）の間は白バーを維持し、その後一定速度で `trailHp` を現在 `hp` に向かって縮小
- `trailHp` が現在 `hp` に到達したら白バーを非表示にする

**代替案:** Phaser Tween で管理 → 純粋な update ループで管理した方がテストしやすく、他の Renderer パターンと一貫するため却下。

### 3. 250HP 区切り線の描画方式

`maxHp / 250` でセグメント数を算出し、HP バーの幅を均等分割して黒い縦線を描画する。`maxHp` が 250 以下の場合は区切り線なし。

### 4. HP バーの表示サイズ

HP バーの幅はエンティティの `radius` に基づいて算出する（`radius * 2` 程度）。高さは固定の小さな値（4-5px）。エンティティの上部（`-radius - offset`）に配置。

### 5. 色の設計

| 要素 | 色 |
|------|-----|
| 味方 HP | 緑 (`0x2ecc71`) |
| 敵 HP | 赤 (`0xe74c3c`) |
| HP バー背景 | 暗いグレー (`0x333333`) |
| トレイリングバー | 白 (`0xffffff`) |
| 区切り線 | 黒 (`0x000000`) |
| 枠線 | 黒 (`0x000000`) |

### 6. HP バーの常時表示

HP バーはエンティティが存在する限り常に表示する。HP が満タンであっても非表示にしない。プレイヤーがユニットの状態を常に把握できるようにするため。

## Risks / Trade-offs

- **毎フレーム Graphics.clear() + 再描画のパフォーマンス** → エンティティ数が少ない Phase 1 では問題ない。将来エンティティが増えた場合は RenderTexture やキャッシュ化を検討（別 Issue）。
- **トレイリングバーの UX チューニング** → 遅延時間・縮小速度は定数化し、プレイテストで調整可能にする。
